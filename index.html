<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Трекер Здоровья - Тимур</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .meal-schedule {
            margin-bottom: 20px;
        }

        .meal-item {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f2ff 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .meal-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .meal-item.completed {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-left-color: #28a745;
        }

        .meal-time {
            font-weight: bold;
            color: #667eea;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .meal-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .meal-description {
            color: #666;
            margin-bottom: 10px;
        }

        .meal-reason {
            font-size: 0.9em;
            color: #555;
            font-style: italic;
            background: rgba(102, 126, 234, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .checkbox {
            width: 25px;
            height: 25px;
            border: 3px solid #667eea;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .checkbox.checked {
            background: #667eea;
            border-color: #667eea;
        }

        .checkbox.checked::after {
            content: '✓';
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .supplements-section {
            margin-top: 20px;
        }

        .supplement-item {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .supplement-item:hover {
            transform: scale(1.02);
        }

        .supplement-item.completed {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }

        .supplement-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .supplement-dose {
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .workout-schedule {
            display: grid;
            gap: 15px;
        }

        .workout-day {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            border-radius: 15px;
            padding: 20px;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .workout-day:hover {
            transform: translateY(-3px);
        }

        .workout-day.completed {
            background: linear-gradient(135deg, #55a3ff 0%, #003d82 100%);
            color: white;
        }

        .workout-day-name {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2d3436;
        }

        .workout-day.completed .workout-day-name {
            color: white;
        }

        .workout-activity {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .workout-day.completed .workout-activity {
            color: white;
        }

        .workout-duration {
            color: #666;
            font-size: 0.9em;
        }

        .workout-day.completed .workout-duration {
            color: rgba(255,255,255,0.8);
        }

        .progress-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .progress-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .progress-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .progress-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .progress-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .progress-ring-container {
            text-align: center;
            margin: 20px 0;
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto;
            position: relative;
        }

        .progress-ring svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring__circle {
            stroke: #e6e6e6;
            stroke-width: 10;
            fill: transparent;
        }

        .progress-ring__progress {
            stroke: #667eea;
            stroke-width: 10;
            stroke-linecap: round;
            fill: transparent;
            transition: stroke-dasharray 0.5s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .notes-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .notes-textarea {
            width: 100%;
            min-height: 100px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-top: 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .day-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .day-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .day-btn.active {
            background: #667eea;
            color: white;
        }

        .vitamin-warning {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .vitamin-warning h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .emoji {
            font-size: 1.5em;
            margin-right: 10px;
        }

        .streak-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700 0%, #ffba08 100%);
            color: #333;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏃‍♂️ Трекер Здоровья</h1>
            <p>Режим: 3 приема пищи + 1 перекус + тренировки</p>
        </div>

        <div class="progress-section">
            <h2>📊 Прогресс дня</h2>
            <div class="progress-ring-container">
                <div class="progress-ring">
                    <svg>
                        <circle class="progress-ring__circle" cx="60" cy="60" r="52"></circle>
                        <circle class="progress-ring__progress" cx="60" cy="60" r="52" id="progressCircle"></circle>
                    </svg>
                    <div class="progress-text" id="progressText">0%</div>
                </div>
            </div>
            
            <div class="progress-grid">
                <div class="progress-card">
                    <div class="progress-number" id="mealsCompleted">0</div>
                    <div class="progress-label">Приемы пищи</div>
                </div>
                <div class="progress-card">
                    <div class="progress-number" id="supplementsCompleted">0</div>
                    <div class="progress-label">Добавки</div>
                </div>
                <div class="progress-card">
                    <div class="progress-number" id="workoutsCompleted">0</div>
                    <div class="progress-label">Тренировки</div>
                </div>
                <div class="progress-card">
                    <div class="progress-number" id="streakCounter">0</div>
                    <div class="progress-label">Дней подряд</div>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <div class="card">
                <h2>🍽️ План питания</h2>
                
                <div class="vitamin-warning">
                    <h3>⚠️ Критический дефицит витамина D</h3>
                    <p>Ваш уровень: 19.5 ng/ml (норма: 30-100 ng/ml)</p>
                    <p><strong>Обязательно принимайте D3!</strong></p>
                </div>

                <div class="meal-schedule">
                    <div class="meal-item" id="breakfast" onclick="toggleMeal('breakfast')">
                        <div class="meal-time">🌅 08:00 - Завтрак</div>
                        <div class="meal-name">Яйца (2-3), овсянка с бананом, витамин D</div>
                        <div class="meal-reason">
                            <strong>Обоснование:</strong> Белки + медленные углеводы + витамин D утром для синтеза гормонов
                        </div>
                        <div class="checkbox-container">
                            <div class="checkbox" id="breakfast-checkbox"></div>
                            <span>Выполнено</span>
                        </div>
                    </div>

                    <div class="meal-item" id="lunch" onclick="toggleMeal('lunch')">
                        <div class="meal-time">🥩 13:00 - Обед</div>
                        <div class="meal-name">Курица/говядина + гречка + салат с маслом</div>
                        <div class="meal-reason">
                            <strong>Обоснование:</strong> Железо + B12 + клетчатка + омега-3 из масла
                        </div>
                        <div class="checkbox-container">
                            <div class="checkbox" id="lunch-checkbox"></div>
                            <span>Выполнено</span>
                        </div>
                    </div>

                    <div class="meal-item" id="snack" onclick="toggleMeal('snack')">
                        <div class="meal-time">🥤 16:00 - Перекус</div>
                        <div class="meal-name">Протеиновый шейк + орехи/фрукты</div>
                        <div class="meal-reason">
                            <strong>Обоснование:</strong> Быстрый белок + жиры, удобно на работе
                        </div>
                        <div class="checkbox-container">
                            <div class="checkbox" id="snack-checkbox"></div>
                            <span>Выполнено</span>
                        </div>
                    </div>

                    <div class="meal-item" id="dinner" onclick="toggleMeal('dinner')">
                        <div class="meal-time">🐟 19:00 - Ужин</div>
                        <div class="meal-name">Рыба/тофу + киноа/рис + брокколи</div>
                        <div class="meal-reason">
                            <strong>Обоснование:</strong> Легкий белок, магний, клетчатка
                        </div>
                        <div class="checkbox-container">
                            <div class="checkbox" id="dinner-checkbox"></div>
                            <span>Выполнено</span>
                        </div>
                    </div>
                </div>

                <div class="supplements-section">
                    <h3>💊 Добавки (обязательно)</h3>
                    
                    <div class="supplement-item" id="vitaminD" onclick="toggleSupplement('vitaminD')">
                        <div class="supplement-name">Витамин D3</div>
                        <div class="supplement-dose">5000 МЕ утром, ежедневно 2 месяца, затем 2000 МЕ для поддержки</div>
                        <div class="checkbox-container">
                            <div class="checkbox" id="vitaminD-checkbox"></div>
                            <span>Принято</span>
                        </div>
                    </div>

                    <div class="supplement-item" id="omega3" onclick="toggleSupplement('omega3')">
                        <div class="supplement-name">Омега-3</div>
                        <div class="supplement-dose">1000 мг EPA+DHA, 1 раз в день</div>
                        <div class="checkbox-container">
                            <div class="checkbox" id="omega3-checkbox"></div>
                            <span>Принято</span>
                        </div>
                    </div>

                    <div class="supplement-item" id="magnesium" onclick="toggleSupplement('magnesium')">
                        <div class="supplement-name">Магний цитрат</div>
                        <div class="supplement-dose">200-300 мг на ночь</div>
                        <div class="checkbox-container">
                            <div class="checkbox" id="magnesium-checkbox"></div>
                            <span>Принято</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>🏃‍♂️ План тренировок</h2>
                
                <div class="day-selector">
                    <div class="day-btn active" onclick="showDay('today')">Сегодня</div>
                    <div class="day-btn" onclick="showDay('week')">Неделя</div>
                </div>

                <div id="todayWorkout" class="workout-display">
                    <div class="workout-day" id="todayWorkoutCard">
                        <div class="workout-day-name" id="todayName">Понедельник</div>
                        <div class="workout-activity" id="todayActivity">🥋 Джиу-джитсу</div>
                        <div class="workout-duration" id="todayDuration">60-90 минут</div>
                        <div class="checkbox-container" onclick="toggleWorkout('today')">
                            <div class="checkbox" id="todayWorkout-checkbox"></div>
                            <span>Выполнено</span>
                        </div>
                    </div>
                </div>

                <div id="weekWorkout" class="workout-display" style="display: none;">
                    <div class="workout-schedule">
                        <div class="workout-day" id="monday" onclick="toggleWorkout('monday')">
                            <div class="workout-day-name">Понедельник</div>
                            <div class="workout-activity"><span class="emoji">🥋</span>Джиу-джитсу</div>
                            <div class="workout-duration">60-90 минут</div>
                            <div class="checkbox-container">
                                <div class="checkbox" id="monday-checkbox"></div>
                                <span>Выполнено</span>
                            </div>
                        </div>

                        <div class="workout-day" id="tuesday" onclick="toggleWorkout('tuesday')">
                            <div class="workout-day-name">Вторник</div>
                            <div class="workout-activity"><span class="emoji">😴</span>Отдых</div>
                            <div class="workout-duration">Восстановление</div>
                        </div>

                        <div class="workout-day" id="wednesday" onclick="toggleWorkout('wednesday')">
                            <div class="workout-day-name">Среда</div>
                            <div class="workout-activity"><span class="emoji">🏃‍♂️</span>Бег</div>
                            <div class="workout-duration">Минимум 30 минут</div>
                            <div class="checkbox-container">
                                <div class="checkbox" id="wednesday-checkbox"></div>
                                <span>Выполнено</span>
                            </div>
                        </div>

                        <div class="workout-day" id="thursday" onclick="toggleWorkout('thursday')">
                            <div class="workout-day-name">Четверг</div>
                            <div class="workout-activity"><span class="emoji">😴</span>Отдых</div>
                            <div class="workout-duration">Восстановление</div>
                        </div>

                        <div class="workout-day" id="friday" onclick="toggleWorkout('friday')">
                            <div class="workout-day-name">Пятница</div>
                            <div class="workout-activity"><span class="emoji">🏃‍♂️</span>Бег</div>
                            <div class="workout-duration">Минимум 30 минут</div>
                            <div class="checkbox-container">
                                <div class="checkbox" id="friday-checkbox"></div>
                                <span>Выполнено</span>
                            </div>
                        </div>

                        <div class="workout-day" id="saturday" onclick="toggleWorkout('saturday')">
                            <div class="workout-day-name">Суббота</div>
                            <div class="workout-activity"><span class="emoji">⚽</span>Футбол</div>
                            <div class="workout-duration">60-90 минут</div>
                            <div class="checkbox-container">
                                <div class="checkbox" id="saturday-checkbox"></div>
                                <span>Выполнено</span>
                            </div>
                        </div>

                        <div class="workout-day" id="sunday" onclick="toggleWorkout('sunday')">
                            <div class="workout-day-name">Воскресенье</div>
                            <div class="workout-activity"><span class="emoji">⚽</span>Футбол</div>
                            <div class="workout-duration">60-90 минут</div>
                            <div class="checkbox-container">
                                <div class="checkbox" id="sunday-checkbox"></div>
                                <span>Выполнено</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="notes-section">
                    <h3>📝 Заметки о тренировке</h3>
                    <textarea class="notes-textarea" id="workoutNotes" placeholder="Как прошла тренировка? Самочувствие, интенсивность, достижения..."></textarea>
                    <button class="btn" onclick="saveWorkoutNotes()">Сохранить заметки</button>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>📔 Дневник самочувствия</h2>
            <div class="notes-section">
                <textarea class="notes-textarea" id="dailyNotes" placeholder="Как вы себя чувствуете сегодня? Уровень энергии, настроение, сон, общее самочувствие..."></textarea>
                <button class="btn" onclick="saveDailyNotes()">Сохранить записи</button>
            </div>
        </div>
    </div>

    <script>
        // Данные пользователя
        let userData = {
            meals: {},
            supplements: {},
            workouts: {},
            notes: {},
            workoutNotes: {},
            streaks: { current: 0, best: 0 }
        };

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            updateTodayWorkout();
            updateProgress();
            updateStreakCounter();
        });

        function getToday() {
            return new Date().toISOString().split('T')[0];
        }

        function getDayName(dayIndex) {
            const days = ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота'];
            return days[dayIndex];
        }

        function getTodayWorkout() {
            const today = new Date().getDay(); // 0 = воскресенье, 1 = понедельник, и т.д.
            const workouts = {
                0: { name: 'Воскресенье', activity: '⚽ Футбол', duration: '60-90 минут', hasWorkout: true },
                1: { name: 'Понедельник', activity: '🥋 Джиу-джитсу', duration: '60-90 минут', hasWorkout: true },
                2: { name: 'Вторник', activity: '😴 Отдых', duration: 'Восстановление', hasWorkout: false },
                3: { name: 'Среда', activity: '🏃‍♂️ Бег', duration: 'Минимум 30 минут', hasWorkout: true },
                4: { name: 'Четверг', activity: '😴 Отдых', duration: 'Восстановление', hasWorkout: false },
                5: { name: 'Пятница', activity: '🏃‍♂️ Бег', duration: 'Минимум 30 минут', hasWorkout: true },
                6: { name: 'Суббота', activity: '⚽ Футбол', duration: '60-90 минут', hasWorkout: true }
            };
            return workouts[today];
        }

        function updateTodayWorkout() {
            const todayWorkout = getTodayWorkout();
            document.getElementById('todayName').textContent = todayWorkout.name;
            document.getElementById('todayActivity').textContent = todayWorkout.activity;
            document.getElementById('todayDuration').textContent = todayWorkout.duration;
            
            const workoutCard = document.getElementById('todayWorkoutCard');
            const checkbox = workoutCard.querySelector('.checkbox-container');
            
            if (!todayWorkout.hasWorkout) {
                checkbox.style.display = 'none';
                workoutCard.style.opacity = '0.6';
            } else {
                checkbox.style.display = 'flex';
                workoutCard.style.opacity = '1';
            }
        }

        function loadUserData() {
            const saved = localStorage.getItem('healthTrackerData');
            if (saved) {
                userData = { ...userData, ...JSON.parse(saved) };
            }
            
            const today = getToday();
            
            // Восстанавливаем состояние еды
            ['breakfast', 'lunch', 'snack', 'dinner'].forEach(meal => {
                if (userData.meals[today] && userData.meals[today][meal]) {
                    const checkbox = document.getElementById(meal + '-checkbox');
                    const item = document.getElementById(meal);
                    checkbox.classList.add('checked');
                    item.classList.add('completed');
                }
            });
            
            // Восстанавливаем состояние добавок
            ['vitaminD', 'omega3', 'magnesium'].forEach(supplement => {
                if (userData.supplements[today] && userData.supplements[today][supplement]) {
                    const checkbox = document.getElementById(supplement + '-checkbox');
                    const item = document.getElementById(supplement);
                    checkbox.classList.add('checked');
                    item.classList.add('completed');
                }
            });
            
            // Восстанавливаем состояние тренировок
            const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            days.forEach(day => {
                if (userData.workouts[today] && userData.workouts[today][day]) {
                    const checkbox = document.getElementById(day + '-checkbox');
                    const item = document.getElementById(day);
                    if (checkbox) checkbox.classList.add('checked');
                    if (item) item.classList.add('completed');
                }
            });
            
            // Восстанавливаем сегодняшнюю тренировку
            if (userData.workouts[today] && userData.workouts[today]['today']) {
                const checkbox = document.getElementById('todayWorkout-checkbox');
                const item = document.getElementById('todayWorkoutCard');
                checkbox.classList.add('checked');
                item.classList.add('completed');
            }
            
            // Восстанавливаем заметки
            if (userData.notes[today]) {
                document.getElementById('dailyNotes').value = userData.notes[today];
            }
            
            if (userData.workoutNotes[today]) {
                document.getElementById('workoutNotes').value = userData.workoutNotes[today];
            }
        }

        function saveUserData() {
            localStorage.setItem('healthTrackerData', JSON.stringify(userData));
        }

        function initializeDay() {
            const today = getToday();
            if (!userData.meals[today]) userData.meals[today] = {};
            if (!userData.supplements[today]) userData.supplements[today] = {};
            if (!userData.workouts[today]) userData.workouts[today] = {};
            if (!userData.notes[today]) userData.notes[today] = '';
            if (!userData.workoutNotes[today]) userData.workoutNotes[today] = '';
        }

        function toggleMeal(mealId) {
            const today = getToday();
            initializeDay();
            
            const checkbox = document.getElementById(mealId + '-checkbox');
            const item = document.getElementById(mealId);
            
            userData.meals[today][mealId] = !userData.meals[today][mealId];
            
            if (userData.meals[today][mealId]) {
                checkbox.classList.add('checked');
                item.classList.add('completed');
            } else {
                checkbox.classList.remove('checked');
                item.classList.remove('completed');
            }
            
            updateProgress();
            updateStreakCounter();
            saveUserData();
        }

        function toggleSupplement(supplementId) {
            const today = getToday();
            initializeDay();
            
            const checkbox = document.getElementById(supplementId + '-checkbox');
            const item = document.getElementById(supplementId);
            
            userData.supplements[today][supplementId] = !userData.supplements[today][supplementId];
            
            if (userData.supplements[today][supplementId]) {
                checkbox.classList.add('checked');
                item.classList.add('completed');
            } else {
                checkbox.classList.remove('checked');
                item.classList.remove('completed');
            }
            
            updateProgress();
            updateStreakCounter();
            saveUserData();
        }

        function toggleWorkout(workoutId) {
            const today = getToday();
            initializeDay();
            
            // Для дней отдыха не делаем ничего
            if (workoutId === 'tuesday' || workoutId === 'thursday') {
                return;
            }
            
            const checkbox = document.getElementById(workoutId + '-checkbox') || document.getElementById('todayWorkout-checkbox');
            const item = document.getElementById(workoutId) || document.getElementById('todayWorkoutCard');
            
            userData.workouts[today][workoutId] = !userData.workouts[today][workoutId];
            
            if (userData.workouts[today][workoutId]) {
                checkbox.classList.add('checked');
                item.classList.add('completed');
            } else {
                checkbox.classList.remove('checked');
                item.classList.remove('completed');
            }
            
            updateProgress();
            updateStreakCounter();
            saveUserData();
        }

        function updateProgress() {
            const today = getToday();
            let totalTasks = 0;
            let completedTasks = 0;
            
            // Подсчет еды
            let mealsCount = 0;
            ['breakfast', 'lunch', 'snack', 'dinner'].forEach(meal => {
                totalTasks++;
                if (userData.meals[today] && userData.meals[today][meal]) {
                    completedTasks++;
                    mealsCount++;
                }
            });
            
            // Подсчет добавок
            let supplementsCount = 0;
            ['vitaminD', 'omega3', 'magnesium'].forEach(supplement => {
                totalTasks++;
                if (userData.supplements[today] && userData.supplements[today][supplement]) {
                    completedTasks++;
                    supplementsCount++;
                }
            });
            
            // Подсчет тренировок (только для дней с тренировками)
            let workoutsCount = 0;
            const todayWorkout = getTodayWorkout();
            if (todayWorkout.hasWorkout) {
                totalTasks++;
                const todayDay = new Date().getDay();
                const dayNames = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
                const todayKey = dayNames[todayDay];
                
                if (userData.workouts[today] && (userData.workouts[today][todayKey] || userData.workouts[today]['today'])) {
                    completedTasks++;
                    workoutsCount++;
                }
            }
            
            // Обновляем прогресс-бар
            const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            const circle = document.getElementById('progressCircle');
            const progressText = document.getElementById('progressText');
            
            const circumference = 2 * Math.PI * 52;
            const offset = circumference - (percentage / 100) * circumference;
            
            circle.style.strokeDasharray = circumference;
            circle.style.strokeDashoffset = offset;
            progressText.textContent = percentage + '%';
            
            // Обновляем карточки прогресса
            document.getElementById('mealsCompleted').textContent = `${mealsCount}/4`;
            document.getElementById('supplementsCompleted').textContent = `${supplementsCount}/3`;
            document.getElementById('workoutsCompleted').textContent = workoutsCount;
        }

        function updateStreakCounter() {
            let currentStreak = 0;
            const today = new Date();
            
            // Проверяем последовательные дни с начала текущего дня
            for (let i = 0; i < 365; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(checkDate.getDate() - i);
                const dateStr = checkDate.toISOString().split('T')[0];
                
                // Проверяем, выполнены ли минимальные требования в этот день
                const dayData = {
                    meals: userData.meals[dateStr] || {},
                    supplements: userData.supplements[dateStr] || {},
                    workouts: userData.workouts[dateStr] || {}
                };
                
                let dayCompleted = true;
                
                // Проверяем витамин D (критически важен)
                if (!dayData.supplements.vitaminD) {
                    dayCompleted = false;
                }
                
                // Проверяем минимум 2 приема пищи
                const mealsCompleted = Object.values(dayData.meals).filter(Boolean).length;
                if (mealsCompleted < 2) {
                    dayCompleted = false;
                }
                
                if (dayCompleted) {
                    currentStreak++;
                } else {
                    break;
                }
            }
            
            userData.streaks.current = currentStreak;
            if (currentStreak > userData.streaks.best) {
                userData.streaks.best = currentStreak;
            }
            
            document.getElementById('streakCounter').textContent = currentStreak;
            
            saveUserData();
        }

        function showDay(type) {
            const todayWorkout = document.getElementById('todayWorkout');
            const weekWorkout = document.getElementById('weekWorkout');
            const dayBtns = document.querySelectorAll('.day-btn');
            
            dayBtns.forEach(btn => btn.classList.remove('active'));
            
            if (type === 'today') {
                todayWorkout.style.display = 'block';
                weekWorkout.style.display = 'none';
                dayBtns[0].classList.add('active');
            } else {
                todayWorkout.style.display = 'none';
                weekWorkout.style.display = 'block';
                dayBtns[1].classList.add('active');
            }
        }

        function saveDailyNotes() {
            const today = getToday();
            const notes = document.getElementById('dailyNotes').value;
            userData.notes[today] = notes;
            saveUserData();
            
            // Показываем уведомление
            showNotification('Заметки сохранены! 📝');
        }

        function saveWorkoutNotes() {
            const today = getToday();
            const notes = document.getElementById('workoutNotes').value;
            userData.workoutNotes[today] = notes;
            saveUserData();
            
            // Показываем уведомление
            showNotification('Заметки о тренировке сохранены! 💪');
        }

        function showNotification(message) {
            // Создаем уведомление
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                z-index: 1000;
                font-weight: bold;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Анимация появления
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Удаление через 3 секунды
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Автосохранение каждые 30 секунд
        setInterval(saveUserData, 30000);

        // Обновление прогресса каждые 5 секунд
        setInterval(updateProgress, 5000);

        // Приветственное сообщение при первом запуске
        if (!localStorage.getItem('healthTrackerData')) {
            setTimeout(() => {
                showNotification('Добро пожаловать в ваш трекер здоровья! 🎉');
            }, 1000);
        }

        // Напоминания (работают только если страница открыта)
        function checkReminders() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const today = getToday();
            
            // Проверяем различные напоминания
            if (hours === 8 && minutes === 0) {
                if (!userData.meals[today] || !userData.meals[today].breakfast) {
                    showNotification('🌅 Время завтрака! Не забудьте витамин D');
                }
            }
            
            if (hours === 13 && minutes === 0) {
                if (!userData.meals[today] || !userData.meals[today].lunch) {
                    showNotification('🥩 Время обеда!');
                }
            }
            
            if (hours === 16 && minutes === 0) {
                if (!userData.meals[today] || !userData.meals[today].snack) {
                    showNotification('🥤 Время перекуса!');
                }
            }
            
            if (hours === 19 && minutes === 0) {
                if (!userData.meals[today] || !userData.meals[today].dinner) {
                    showNotification('🐟 Время ужина!');
                }
            }
            
            if (hours === 21 && minutes === 0) {
                if (!userData.supplements[today] || !userData.supplements[today].magnesium) {
                    showNotification('🌙 Время принять магний!');
                }
            }
        }

        // Проверяем напоминания каждую минуту
        setInterval(checkReminders, 60000);

        // Дополнительная функция для экспорта данных
        function exportData() {
            const dataStr = JSON.stringify(userData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'health_tracker_data.json';
            link.click();
            URL.revokeObjectURL(url);
            
            showNotification('Данные экспортированы! 📊');
        }

        // Добавляем кнопку экспорта (можно вызвать из консоли)
        window.exportHealthData = exportData;
        
        console.log('🏃‍♂️ Трекер здоровья загружен!');
        console.log('💡 Используйте exportHealthData() для экспорта данных');
    </script>
</body>
</html>
